<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mdmItem">

	<!--  创建func_dict信息  -->
	<insert id="createMdmItem" parameterType="Map" useGeneratedKeys="true" keyProperty="id">
		insert into mdm_item(item_id,item_category_id,item_description,uom,segment1,segment2,segment3,
		segment4,segment5,segment6,segment7,segment8,segment9,segment10,attribute1,attribute2)
		values (#{item_id},'${item_category_id}','${item_description}','${uom}',
		<if  test="segment1 == null">NULL</if> <if  test="segment1 != null">#{segment1}</if>,
		<if  test="segment2 == null">NULL</if> <if  test="segment2 != null">#{segment2}</if>,
		<if  test="segment3 == null">NULL</if> <if  test="segment3 != null">#{segment3}</if>,
		<if  test="segment4 == null">NULL</if> <if  test="segment4 != null">#{segment4}</if>,
		<if  test="segment5 == null">NULL</if> <if  test="segment5 != null">#{segment5}</if>,
		<if  test="segment6 == null">NULL</if> <if  test="segment6 != null">#{segment6}</if>,
		<if  test="segment7 == null">NULL</if> <if  test="segment7 != null">#{segment7}</if>,
		<if  test="segment8 == null">NULL</if> <if  test="segment8 != null">#{segment8}</if>,
		<if  test="segment9 == null">NULL</if> <if  test="segment9 != null">#{segment9}</if>,
		<if  test="segment10 == null">NULL</if> <if  test="segment10 != null">#{segment10}</if>,
		<if  test="attribute1 == null">NULL</if> <if  test="attribute1 != null">#{attribute1}</if>,
		<if  test="attribute2 == null">NULL</if> <if  test="attribute2 != null">#{attribute2}</if>
		)
	</insert>

	<!-- 修改 func_dict 表的信息 -->
	<update id="updateMdmItem" parameterType="Map">
		update mdm_item set
		<if  test="item_category_id == null">item_category_id=NULL</if>
		<if  test="item_category_id != null">item_category_id=#{item_category_id}</if>,
		<if  test="item_description == null">item_description=NULL</if>
		<if  test="item_description != null">item_description=#{item_description}</if>,
		<if  test="uom == null">uom=NULL</if>
		<if  test="uom != null">uom=#{uom}</if>,
		<if  test="segment1 == null">segment1=NULL</if>
		<if  test="segment1 != null">segment1=#{segment1}</if>,
		<if  test="segment2 == null">segment2=NULL</if>
		<if  test="segment2 != null">segment2=#{segment2}</if>,
		<if  test="segment3 == null">segment3=NULL</if>
		<if  test="segment3 != null">segment3=#{segment3}</if>,
		<if  test="segment4 == null">segment4=NULL</if>
		<if  test="segment4 != null">segment4=#{segment4}</if>,
		<if  test="segment5 == null">segment5=NULL</if>
		<if  test="segment5 != null">segment5=#{segment5}</if>,
		<if  test="segment6 == null">segment6=NULL</if>
		<if  test="segment6 != null">segment6=#{segment6}</if>,
		<if  test="segment7 == null">segment7=NULL</if>
		<if  test="segment7 != null">segment7=#{segment7}</if>,
		<if  test="segment8 == null">segment8=NULL</if>
		<if  test="segment8 != null">segment8=#{segment8}</if>,
		<if  test="segment9 == null">segment9=NULL</if>
		<if  test="segment9 != null">segment9=#{segment9}</if>,
		<if  test="segment10 == null">segment10=NULL</if>
		<if  test="segment10 != null">segment10=#{segment10}</if>,
		<if  test="attribute1 == null">attribute1=NULL</if>
		<if  test="attribute1 != null">attribute1=#{attribute1}</if>,
		<if  test="attribute2 == null">attribute2=NULL</if>
		<if  test="attribute2 != null">attribute2=#{attribute2}</if>
		 where item_id=#{item_id}
	</update>

	<select id="getMaxId" resultType="java.lang.Integer" >
        SELECT (MAX(item_id) +1)as item_id from mdm_item
    </select>

	<select id="getItemByCategoryId" parameterType="map" resultType="map">
        SELECT u.* FROM mdm_item u where u.item_category_id = #{item_category_id}
    </select>


	<select id="getItemByItemId" parameterType="map" resultType="map">
        SELECT u.*,mic.category_name,mic.category_code FROM mdm_item u left join mdm_item_category mic on mic.category_id = u.item_category_id
        where u.item_id = #{item_id}
    </select>

	<select id="getAllPage" resultType="Map" parameterType="Map">
		SELECT u.item_id,u.item_category_id,u.item_description,d1.value_name as segment1 ,
		d2.value_name as segment2,
		d3.value_name as segment3,
		d4.value_name as segment4,
		d5.value_name as segment5,
		d6.value_name as segment6,
		d7.value_name as segment7,
		d8.value_name as segment8,
		d9.value_name as segment9,
		d10.value_name as segment10,
		d11.value_name as attribute1,
		d12.value_name as attribute2
		FROM mdm_item u
		LEFT JOIN mdm_dict_value d1 on u.segment1=d1.value_id
		LEFT JOIN mdm_dict_value d2 on u.segment2=d2.value_id
		LEFT JOIN mdm_dict_value d3 on u.segment3=d3.value_id
		LEFT JOIN mdm_dict_value d4 on u.segment4=d4.value_id
		LEFT JOIN mdm_dict_value d5 on u.segment5=d5.value_id
		LEFT JOIN mdm_dict_value d6 on u.segment6=d6.value_id
		LEFT JOIN mdm_dict_value d7 on u.segment7=d7.value_id
		LEFT JOIN mdm_dict_value d8 on u.segment8=d8.value_id
		LEFT JOIN mdm_dict_value d9 on u.segment9=d9.value_id
		LEFT JOIN mdm_dict_value d10 on u.segment10=d10.value_id
		LEFT JOIN mdm_dict_value d11 on u.attribute1=d11.value_id
		LEFT JOIN mdm_dict_value d12 on u.attribute2=d12.value_id
		where  1=1
		<if  test="item_category_id != null and item_category_id!='' ">
			and  u.item_category_id='${item_category_id}'
		</if>
		<if  test="item_description != null and item_description!='' ">
			and  u.item_description like '%${item_description}%'
		</if>
    </select>

	<select id="getAllPageByCategoryId" parameterType="map" resultType="map">
		SELECT u.*  FROM mdm_item u  where  1=1
		<if  test="item_category_id != null and item_category_id!='' ">
			and  u.item_category_id='${item_category_id}'
		</if>
	</select>

	<!-- 根据dict_id 跟 dict_out_id 删除func_dict_out 表相关信息  -->
	<delete id="deleteItemByID" parameterType="java.lang.String">
        delete from mdm_item where item_id=#{item_id}
    </delete>

	<delete id="deleteItemByCategoryID" parameterType="Map">
        delete from mdm_item where item_category_id=#{item_category_id}
    </delete>
</mapper>
